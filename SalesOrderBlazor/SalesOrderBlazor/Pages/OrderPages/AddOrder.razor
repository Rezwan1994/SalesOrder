@page "/OrderPages/AddOrder"
@using SalesOrderBlazor.Models

@inject HttpClient Http
<style>
    .modal {
        display: block;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 10% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
</style>
<EditForm Model="order">
    <DataAnnotationsValidator/>
    <div class="row">
        <div class="col-md-6">
            <h3>AddOrder</h3>
            <div class="form-group">
                <label>Name</label>
                <InputText class="form-control" @bind-Value="@order.Name"></InputText>
                <ValidationMessage For="@(()=>order.Name)"/>
            </div>
            <div class="form-group">
                <label>State</label>
                <InputText class="form-control" @bind-Value="@order.State"></InputText>
                <ValidationMessage For="@(()=>order.State)" />
            </div>
          
          
        </div>
        <div class="col-md-6" style="border:solid">
            <h3>Add Window</h3>
           
            <div class="form-group">
                <label>Name</label>
                <InputText class="form-control" @bind-Value="@window.Name"></InputText>
                <ValidationMessage For="@(()=>window.Name)" />
            </div>
            <div class="form-group">
                <label>Quantity Of Windows</label>
                <InputText class="form-control" @bind-Value="@window.QuantityOfWindows"></InputText>
                <ValidationMessage For="@(()=>window.QuantityOfWindows)" />
            </div>
            <div class="form-group">
                <label>Total Sub Elements</label>
                <InputText class="form-control" @bind-Value="@window.TotalSubElements"></InputText>
                <ValidationMessage For="@(()=>window.TotalSubElements)" />
            </div>
            <button @onclick="AddWindow" class="btn-info">Add</button>
        </div>

        <div class="col-md-12">
            <h3>Window List</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>QuantityOfWindows</th>
                        <th>TotalSubElements</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in winList)
                    {
                        <tr>
                            <td>@item.Name</td>
                            <td>@item.QuantityOfWindows</td>
                            <td>@item.TotalSubElements</td>
                            <td>
                                <button  @onclick="() => ShowPopUp(item)" class="btn-info">Add Element</button>
                                
                            </td>
                            <td>
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Element</th>
                                            <th>Type</th>
                                            <th>Width</th>
                                            <th>Height</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @if(item.SubElements != null && item.SubElements.Count > 0)
                                        {
                                            @foreach (var element in item.SubElements)
                                            {
                                                <tr>
                                                    <td>@element.Element</td>
                                                    <td>@element.Type</td>
                                                    <td>@element.Width</td>
                                                    <td>
                                                        @element.Height
                                                    </td>

                                                </tr>
                                            }
                                        }
                                     
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <button style="float:right;" @onclick="AddOrders" class="btn-info">Save</button>
    </div>
    @if (showModal)
    {
        <div class="modal">
            <div class="modal-content">
                <span class="close" @onclick="() => showModal = false">&times;</span>
                <h2>Add SubElement</h2>
             
                    <div class="form-group">
                        <label>Element</label>
                        <InputText class="form-control" @bind-Value="@sub.Element"></InputText>
                        <ValidationMessage For="@(()=>sub.Element)" />
                    </div>
                    <div class="form-group">
                        <label>Type</label>
                        <InputText class="form-control" @bind-Value="@sub.Type"></InputText>
                        <ValidationMessage For="@(()=>sub.Type)" />
                    </div>
                    <div class="form-group">
                        <label>Width</label>
                        <InputText class="form-control" @bind-Value="@sub.Width"></InputText>
                        <ValidationMessage For="@(()=>sub.Width)" />
                    </div>

                    <div class="form-group">
                        <label>Height</label>
                        <InputText class="form-control" @bind-Value="@sub.Height"></InputText>
                        <ValidationMessage For="@(()=>sub.Height)" />
                    </div>
                <button @onclick="AddElement" class="btn-info">Add</button>

            </div>
        </div>
    }
</EditForm>
@code {

    private bool showModal = false;
    Order order = new Order();
    Window window = new Window();
    SubElement sub = new SubElement();
    [Parameter]
    public Window windowObject { get; set; }
    public List<Window> winList = new List<Window>();
    public List<SubElement> subList = new List<SubElement>();
    async Task AddOrders()
    {
        order.Windows = winList;
        var data = await Http.PostAsJsonAsync<Order>("https://localhost:7274/api/Order/createOrder", order);
    }  
    async Task AddWindow()
    {
        window.SubElements = new List<SubElement>();
        winList.Add(window);
        window = new Window();

    }
    async Task ShowPopUp(Window win)
    {
        
        showModal = true;
        windowObject = win;
       
    }
    async Task AddElement()
    {
        //subList.Add(sub);
        windowObject.SubElements.Add(sub);
        //subList = new List<SubElement>();
        sub = new SubElement();
        showModal = false;
    }

}
